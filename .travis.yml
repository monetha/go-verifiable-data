language: go
sudo: false

go:
  - 1.x

cache:
  directories:
    - vendor

env:
  global:
    - ARTIFACTS_DIR=artifacts

install:
  - make dependencies

script:
  - make lint
  - make test

after_success:
  - make cover
  - bash <(curl -s https://codecov.io/bash) -s ./${ARTIFACTS_DIR}/.cover
  - make cmdx

addons:
  artifacts:
    debug: true
    s3_region: ${ARTIFACTS_S3_REGION}
    working_dir: ${ARTIFACTS_DIR}
    paths:
      - $(ls ${ARTIFACTS_DIR}/*.{zip,tgz} | tr "\n" ":")
      - cover.html
    target_paths:
      - /${TRAVIS_REPO_SLUG}/${TRAVIS_COMMIT}
  apt:
    update: true
    packages:
      - zip
